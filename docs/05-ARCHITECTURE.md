# ë¸”ë¡œê·¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

> WEB + WAS 3-TIER êµ¬ì¡° (Hugo ì •ì  ë¸”ë¡œê·¸ + Spring Boot API)

**ì‘ì„±ì¼**: 2026-01-21
**ìµœì¢… ìˆ˜ì •**: 2026-01-24
**ìƒíƒœ**: âœ… Production ìš´ì˜ ì¤‘ (58ì¼+)

---

## ëª©ì°¨

1. [í´ëŸ¬ìŠ¤í„° êµ¬ì„±](#í´ëŸ¬ìŠ¤í„°-êµ¬ì„±)
2. [ì„œë¹„ìŠ¤ë³„ HA/Failover ì„¤ì •](#ì„œë¹„ìŠ¤ë³„-hafailover-ì„¤ì •)
3. [ì „ì²´ ì•„í‚¤í…ì²˜](#ì „ì²´-ì•„í‚¤í…ì²˜)
4. [WEB (Hugo ë¸”ë¡œê·¸)](#web-hugo-ë¸”ë¡œê·¸)
5. [WAS (Spring Boot API)](#was-spring-boot-api)
6. [ë°ì´í„°ë² ì´ìŠ¤ (MySQL)](#ë°ì´í„°ë² ì´ìŠ¤-mysql)
7. [ë„¤íŠ¸ì›Œí‚¹ (Istio)](#ë„¤íŠ¸ì›Œí‚¹-istio)
8. [CI/CD íŒŒì´í”„ë¼ì¸](#cicd-íŒŒì´í”„ë¼ì¸)
9. [WAS ê°œì„  ê°€ëŠ¥ í•­ëª©](#was-ê°œì„ -ê°€ëŠ¥-í•­ëª©)

---

## í´ëŸ¬ìŠ¤í„° êµ¬ì„±

### ë…¸ë“œ êµ¬ì„±

| ë…¸ë“œ | ì—­í•  | IP | ë¹„ê³  |
|------|------|-----|------|
| **k8s-cp** | Control Plane | 192.168.X.187 | Master, etcd, API Server |
| **k8s-worker1** | Worker | 192.168.X.61 | ì›Œí¬ë¡œë“œ ë¶„ì‚° |
| **k8s-worker2** | Worker | 192.168.X.62 | ì›Œí¬ë¡œë“œ ë¶„ì‚° |
| **k8s-worker3** | Worker | 192.168.X.60 | ì›Œí¬ë¡œë“œ ë¶„ì‚° (2026-01-22 ì¶”ê°€) |

### Kubernetes ë²„ì „

```
Kubernetes: v1.31.13
Container Runtime: containerd://2.1.5 (worker1,2), 1.7.28 (worker3)
CNI: Cilium v1.18.4 (eBPF ê¸°ë°˜)
CSI: Longhorn v1.7.2
```

### ìŠ¤í† ë¦¬ì§€ êµ¬ì„±

| ìŠ¤í† ë¦¬ì§€ | ìš©ë„ | íŠ¹ì§• |
|----------|------|------|
| **Longhorn** | Stateful ì„œë¹„ìŠ¤ (MySQL, Loki) | Replica 3 (worker 3ê°œ), ìë™ Failover |
| **NFS** | Monitoring (Grafana, Prometheus) | ë‹¨ì¼ ë…¸ë“œ (NAS) |
| **Local Path** | ì„ì‹œ ë°ì´í„° | ë…¸ë“œ ë¡œì»¬ ë””ìŠ¤í¬ |

---

## ì„œë¹„ìŠ¤ë³„ HA/Failover ì„¤ì •

### Failover ë©”ì»¤ë‹ˆì¦˜ ì´í•´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Failover ì¢…ë¥˜                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. Kubernetes ê¸°ë³¸ Failover (Stateless)                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     5ë¶„ í›„     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚ Node    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ Taint   â”‚ â†’ Pod Eviction       â”‚
â”‚     â”‚ ì¥ì•     â”‚  (ê¸°ë³¸ê°’)     â”‚ ì ìš©    â”‚ â†’ ë‹¤ë¥¸ ë…¸ë“œì— ì¬ìƒì„±  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                  â”‚
â”‚  2. Longhorn Failover (Stateful)                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     30ì´ˆ~2ë¶„   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚ Node    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ Pod     â”‚ â†’ ë‹¤ë¥¸ ë…¸ë“œì—ì„œ      â”‚
â”‚     â”‚ ì¥ì•     â”‚  (ë¹ ë¥¸ íƒì§€)  â”‚ ì‚­ì œ    â”‚ â†’ Replicaë¡œ ë³µêµ¬     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                  â”‚
â”‚  3. topologySpreadConstraints (ì‚¬ì „ ë¶„ì‚°, 3-worker)              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â”‚  Worker1   â”‚   Worker2   â”‚   Worker3            â”‚         â”‚
â”‚     â”‚   Pod A    â”‚    Pod B    â”‚    Pod C  â† 3ê°œ ë¶„ì‚° â”‚         â”‚
â”‚     â”‚            â”‚             â”‚           â†’ HA ê°•í™”   â”‚         â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë¹„ìŠ¤ ë¶„ë¥˜

#### 1ï¸âƒ£ Stateful + Longhorn (ìë™ Failover 30ì´ˆ~2ë¶„)

| ì„œë¹„ìŠ¤ | Namespace | PVC | Replicas | ë³µêµ¬ ì‹œê°„ |
|--------|-----------|-----|----------|----------|
| **MySQL** | blog-system | mysql-pvc (5Gi) | 1 | 30ì´ˆ~2ë¶„ |
| **Loki** | monitoring | storage-loki-stack-0 (10Gi) | 1 | 30ì´ˆ~2ë¶„ |

**Longhorn ì„¤ì •:**
```yaml
# /k8s-manifests/docs/helm/longhorn/values.yaml
defaultSettings:
  defaultReplicaCount: 2
  nodeDownPodDeletionPolicy: delete-both-statefulset-and-deployment-pod
```

**ì™œ Longhorn Failoverê°€ ë¹ ë¥¸ê°€?**
- Longhorn Managerê°€ ë…¸ë“œ ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§
- `nodeDownPodDeletionPolicy` ì„¤ì •ìœ¼ë¡œ Pod ìë™ ì‚­ì œ
- ë‹¤ë¥¸ ë…¸ë“œì— ì´ë¯¸ Replicaê°€ ìˆìœ¼ë¯€ë¡œ ì¦‰ì‹œ ë³µêµ¬ ê°€ëŠ¥

#### 2ï¸âƒ£ Stateful + NFS (ìˆ˜ë™ ë³µêµ¬ í•„ìš”)

| ì„œë¹„ìŠ¤ | Namespace | PVC | ë³µêµ¬ ë°©ë²• |
|--------|-----------|-----|----------|
| **Grafana** | monitoring | grafana-data-pvc (10Gi) | NAS ì˜ì¡´, K8s ê¸°ë³¸ Failover |
| **Prometheus** | monitoring | prometheus-data-pvc (50Gi) | NAS ì˜ì¡´, K8s ê¸°ë³¸ Failover |
| **Pushgateway** | monitoring | pushgateway-data-pvc (5Gi) | NAS ì˜ì¡´, K8s ê¸°ë³¸ Failover |

**ì£¼ì˜:** NFSëŠ” ë‹¨ì¼ NASì— ì˜ì¡´í•˜ë¯€ë¡œ NAS ì¥ì•  ì‹œ ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ë‹¨

#### 3ï¸âƒ£ Stateless (K8s ê¸°ë³¸ Failover 5ë¶„)

| ì„œë¹„ìŠ¤ | Namespace | Replicas | topologySpread | ë‹¤ìš´íƒ€ì„ |
|--------|-----------|----------|----------------|----------|
| **WEB** | blog-system | 2 | âœ… ScheduleAnyway | 0ì´ˆ |
| **WAS** | blog-system | 2~10 (HPA) | âœ… ScheduleAnyway | 0ì´ˆ |
| **Istio Ingress** | istio-system | 2 | âœ… DoNotSchedule | 0ì´ˆ |
| **Alertmanager** | monitoring | 1 | N/A | 5ë¶„ |
| **kube-state-metrics** | monitoring | 1 | N/A | 5ë¶„ |
| **ArgoCD** | argocd | ê° 1 | N/A | 5ë¶„ |

### í˜„ì¬ Pod ë¶„í¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        k8s-worker1                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ blog-system:  mysql, was, web                â† ë¶„ì‚° ë°°ì¹˜        â”‚
â”‚ monitoring:   alertmanager, kube-state-metrics, loki-stack,     â”‚
â”‚               cadvisor, node-exporter, promtail, nginx-exporter,â”‚
â”‚               prometheus-adapter                                 â”‚
â”‚ argocd:       controller, dex, notifications, redis, server     â”‚
â”‚ istio:        istiod, ingress, egress, jaeger, kiali           â”‚
â”‚ longhorn:     manager, csi-plugin, ui                           â”‚
â”‚ falco:        falco (DaemonSet), falcosidekick, talon          â”‚
â”‚ metallb:      controller, speaker                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        k8s-worker2                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ blog-system:  was, web                       â† ë¶„ì‚° ë°°ì¹˜        â”‚
â”‚ monitoring:   grafana, prometheus, pushgateway, cadvisor        â”‚
â”‚ argocd:       repo-server                                       â”‚
â”‚ istio:        ingress                        â† ë¶„ì‚° ë°°ì¹˜        â”‚
â”‚ longhorn:     manager, csi-plugin, instance-manager             â”‚
â”‚ falco:        falco (DaemonSet)                                 â”‚
â”‚ metallb:      speaker                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        k8s-worker3                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ blog-system:  was, web                       â† ë¶„ì‚° ë°°ì¹˜        â”‚
â”‚ longhorn:     manager, csi-plugin                               â”‚
â”‚ falco:        falco (DaemonSet)                                 â”‚
â”‚ metallb:      speaker                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        k8s-cp (Control Plane)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ monitoring:   promtail (ë¡œê·¸ ìˆ˜ì§‘ë§Œ)                            â”‚
â”‚ metallb:      speaker                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë³µêµ¬ ì‹œê°„ ìš”ì•½í‘œ

| ì„œë¹„ìŠ¤ ìœ í˜• | ì €ì¥ì†Œ | ë³µêµ¬ ë°©ì‹ | ì˜ˆìƒ ë‹¤ìš´íƒ€ì„ |
|-------------|--------|-----------|---------------|
| Stateful + Longhorn | Longhorn | ìë™ (Longhorn Failover, Replica 3) | **30ì´ˆ~2ë¶„** |
| Stateful + NFS | NFS | ìë™ (K8s ê¸°ë³¸) | **5ë¶„** |
| Stateless (replicas=1) | ì—†ìŒ | ìë™ (K8s ê¸°ë³¸) | **5ë¶„** |
| Stateless (replicasâ‰¥2, spread) | ì—†ìŒ | ì¦‰ì‹œ (ë¯¸ë¦¬ ë¶„ì‚°) | **0ì´ˆ** |
| Stateless (replicasâ‰¥2, no spread) | ì—†ìŒ | ë¶€ë¶„ (ì¼ë¶€ë§Œ ë¶„ì‚°) | **0~5ë¶„** |

### âœ… ì™„ë£Œëœ ê°œì„ ì‚¬í•­

1. **WEB/WASì— topologySpreadConstraints ì ìš©** âœ…
   - ì ìš©: ScheduleAnyway (soft constraint)ë¡œ 3-worker í´ëŸ¬ìŠ¤í„° í˜¸í™˜
   - dynamicStableScale: trueë¡œ Canary ë°°í¬ ì¤‘ì—ë„ Pod ìˆ˜ ìœ ì§€
   - íš¨ê³¼: ë‹¤ìš´íƒ€ì„ 0ì´ˆ, HA ë³´ì¥
   - ì°¸ê³ : [01-project.md](01-project.md) - ì‹¤íŒ¨ ì‚¬ë¡€ 2

2. **Istio Ingress Gateway HA ì ìš©** âœ…
   - ì ìš©: replicas 2 + topologySpreadConstraints
   - íš¨ê³¼: Gateway ì¥ì•  ì‹œì—ë„ ë‹¤ìš´íƒ€ì„ 0ì´ˆ

3. **DevSecOps P0 ê°œì„  ì™„ë£Œ** âœ… (2026-01-23)
   - SecurityContext ì ìš© (runAsNonRoot, capabilities drop)
   - MySQL ìë™ ë°±ì—… CronJob (ë§¤ì¼ 03:00 KST â†’ S3)
   - Loki Retention 7ì¼ ì„¤ì • (ë””ìŠ¤í¬ ê³ ê°ˆ ë°©ì§€)
   - Private GHCR + imagePullSecrets (ì½˜í…ì¸  ë¬´ë‹¨ ë³µì œ ë°©ì§€)
   - Falco Talon IPS Dry-Run Phase 1 (NetworkPolicy ê¸°ë°˜ ìë™ ê²©ë¦¬)

### ì„ íƒì  ê°œì„ ì‚¬í•­

1. **tolerationSeconds ì¡°ì • (ì„ íƒ)**
   - í˜„ì¬: 300ì´ˆ (5ë¶„) ê¸°ë³¸ê°’
   - ê°œì„ : 60ì´ˆë¡œ ë‹¨ì¶• ê°€ëŠ¥
   - ì£¼ì˜: ë„ˆë¬´ ì§§ìœ¼ë©´ ì¼ì‹œì  ë„¤íŠ¸ì›Œí¬ ë¬¸ì œì—ë„ eviction ë°œìƒ

---

## ì „ì²´ ì•„í‚¤í…ì²˜

> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-01-24 - Istio Gateway ì¼ì›í™” (Nginx Ingress ì œê±°)

### ëª©ì°¨

1. [í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼ ê²½ë¡œ](#1-í´ë¼ì´ì–¸íŠ¸-ì ‘ê·¼-ê²½ë¡œ-ì™¸ë¶€--kubernetes)
2. [Istio Service Mesh ì—­í• ](#2-istio-service-mesh-ì—­í• )
3. [Cilium CNI ì—­í• ](#3-cilium-cni-ì—­í• )

---

### 1. í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼ ê²½ë¡œ (ì™¸ë¶€ â†’ Kubernetes)

**ì‚¬ìš©ìê°€ `https://blog.jiminhome.shop/` ì ‘ì† ì‹œ íŠ¸ë˜í”½ í”Œë¡œìš°**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ì‚¬ìš©ì ë¸Œë¼ìš°ì €                                                  â”‚
â”‚   URL: https://blog.jiminhome.shop/                                     â”‚
â”‚   DNS: Cloudflare DNS (1.1.1.1)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTPS Request (TLS Handshake)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Cloudflare CDN (Edge Network)                                   â”‚
â”‚   â”œâ”€ SSL/TLS Termination (HTTPS â†’ HTTP)                                â”‚
â”‚   â”œâ”€ DDoS Protection (Layer 3/4/7)                                      â”‚
â”‚   â”œâ”€ WAF (Web Application Firewall)                                     â”‚
â”‚   â”‚   - SQL Injection ì°¨ë‹¨                                              â”‚
â”‚   â”‚   - XSS ì°¨ë‹¨                                                        â”‚
â”‚   â”‚   - Bot íƒì§€ (Challenge Page)                                      â”‚
â”‚   â”œâ”€ Cache (ì •ì  íŒŒì¼ ìºì‹±)                                             â”‚
â”‚   â”‚   - Cache-Control: max-age=3600 (1ì‹œê°„)                            â”‚
â”‚   â”‚   - CSS, JS, ì´ë¯¸ì§€ ìºì‹±                                            â”‚
â”‚   â””â”€ Origin ì—°ê²°: 192.168.1.200:80                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP Request (í‰ë¬¸)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Home Network Router (192.168.1.1)                               â”‚
â”‚   â””â”€ Port Forwarding: 80 â†’ 192.168.1.200                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: MetalLB LoadBalancer (L2 Mode)                                  â”‚
â”‚   â”œâ”€ External-IP: 192.168.1.200 (ARP ì‘ë‹µ)                             â”‚
â”‚   â”œâ”€ Service: istio-system/istio-ingressgateway                        â”‚
â”‚   â””â”€ Target: istio-ingressgateway Pod (Port 8080)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ClusterIP:80 â†’ Pod:8080
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Istio Gateway (istio-ingressgateway Pod)                        â”‚
â”‚   â”œâ”€ Gateway ë¦¬ì†ŒìŠ¤: blog-system/blog-gateway                          â”‚
â”‚   â”œâ”€ Host ë§¤ì¹­: blog.jiminhome.shop                                    â”‚
â”‚   â”œâ”€ Port: 80 (HTTP)                                                    â”‚
â”‚   â””â”€ VirtualService ê²€ìƒ‰ â†’ blog-system/blog-routes                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ L7 Routing (HTTP Path ê¸°ë°˜)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: VirtualService (blog-system/blog-routes)                        â”‚
â”‚                                                                          â”‚
â”‚   Route 1: /api/** â†’ web-service:80 (nginx proxy)                      â”‚
â”‚   â”œâ”€ Retry: 3 attempts, 2s per try                                     â”‚
â”‚   â”œâ”€ Timeout: 5s                                                        â”‚
â”‚   â””â”€ DestinationRule: web-service (subset: stable/canary)              â”‚
â”‚                                                                          â”‚
â”‚   Route 2: /* â†’ web-service:80 (ì •ì  íŒŒì¼)                             â”‚
â”‚   â”œâ”€ DestinationRule: web-service (subset: stable/canary)              â”‚
â”‚   â””â”€ Canary Weight: stable 90%, canary 10% (Argo Rollouts ì œì–´)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Cilium eBPF Load Balancing (ClusterIP â†’ Pod IP)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7a: WEB Pod       â”‚ Step 7b: WAS Pod (nginx proxy ê²½ìœ )          â”‚
â”‚ (nginx:alpine)         â”‚ (Spring Boot)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nginx ì •ì  íŒŒì¼ ì„œë¹™   â”‚ /api ìš”ì²­ ì²˜ë¦¬                                 â”‚
â”‚ /usr/share/nginx/html  â”‚   â†“                                            â”‚
â”‚ - Hugo ë¹Œë“œ ê²°ê³¼       â”‚ Spring Boot @RestController                    â”‚
â”‚ - index.html           â”‚   â†“                                            â”‚
â”‚ - CSS, JS, ì´ë¯¸ì§€      â”‚ JDBC Connection Pool                           â”‚
â”‚                        â”‚   â†“ (Istio mesh ì œì™¸, í‰ë¬¸ TCP)               â”‚
â”‚                        â”‚ MySQL Pod (mysql-service:3306)                 â”‚
â”‚                        â”‚ - Database: board                              â”‚
â”‚                        â”‚ - User: board_user                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ ë³€ê²½ ì‚¬í•­ (2026-01-24)**:

```
Before (2026-01-23):
Cloudflare â†’ MetalLB â†’ Nginx Ingress â†’ Istio Gateway â†’ Services
                         â†“ ì¤‘ë³µ        â†“
                       L7 Routing    L7 Routing

After (2026-01-24):
Cloudflare â†’ MetalLB â†’ Istio Gateway â†’ Services
                         â†“
                    ë‹¨ì¼ L7 ì§„ì…ì 
```

**ê°œì„  íš¨ê³¼**:
- âœ… Nginx Ingress ì œê±° (ì¤‘ë³µ ë ˆì´ì–´ ì œê±°)
- âœ… Hop 1ê°œ ê°ì†Œ (ë ˆì´í„´ì‹œ ê°ì†Œ)
- âœ… Istio ê¸°ëŠ¥ ì™„ì „ í™œìš© (Retry, Timeout, Circuit Breaker)
- âœ… ë‹¨ì¼ ì§„ì…ì  ê´€ë¦¬ (ë³µì¡ë„ ê°ì†Œ)

---

### 2. Istio Service Mesh ì—­í• 

**Istioê°€ ë‹´ë‹¹í•˜ëŠ” ê³„ì¸µ: L7 (Application Layer)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Istio Service Mesh ì»´í¬ë„ŒíŠ¸                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 1. Istio Gateway (istio-ingressgateway)                      â”‚       â”‚
â”‚  â”‚    â”œâ”€ ì™¸ë¶€ íŠ¸ë˜í”½ ì§„ì…ì  (L7 Routing)                       â”‚       â”‚
â”‚  â”‚    â”œâ”€ Host ê¸°ë°˜ ë¼ìš°íŒ… (*.jiminhome.shop)                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ Cross-Namespace VirtualService ì§€ì›                   â”‚       â”‚
â”‚  â”‚    â”‚   - blog.jiminhome.shop â†’ blog-system/blog-routes      â”‚       â”‚
â”‚  â”‚    â”‚   - monitoring.jiminhome.shop â†’ monitoring/...         â”‚       â”‚
â”‚  â”‚    â”‚   - argocd.jiminhome.shop â†’ argocd/...                 â”‚       â”‚
â”‚  â”‚    â””â”€ MetalLB LoadBalancer (192.168.1.200)                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 2. VirtualService (L7 íŠ¸ë˜í”½ ë¼ìš°íŒ…)                         â”‚       â”‚
â”‚  â”‚    â”œâ”€ URI ê¸°ë°˜ ë¼ìš°íŒ…                                        â”‚       â”‚
â”‚  â”‚    â”‚   - /api/** â†’ was-service (API ìš”ì²­)                   â”‚       â”‚
â”‚  â”‚    â”‚   - /* â†’ web-service (ì •ì  íŒŒì¼)                        â”‚       â”‚
â”‚  â”‚    â”œâ”€ Retry ì •ì±…                                             â”‚       â”‚
â”‚  â”‚    â”‚   - attempts: 3                                         â”‚       â”‚
â”‚  â”‚    â”‚   - perTryTimeout: 2s                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ Timeout ì„¤ì •                                           â”‚       â”‚
â”‚  â”‚    â”‚   - timeout: 5s (ì „ì²´ ìš”ì²­)                             â”‚       â”‚
â”‚  â”‚    â””â”€ Canary Weight ì œì–´ (Argo Rollouts ì—°ë™)               â”‚       â”‚
â”‚  â”‚        - stable: 90%, canary: 10%                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 3. DestinationRule (íŠ¸ë˜í”½ ì •ì±…)                             â”‚       â”‚
â”‚  â”‚    â”œâ”€ mTLS ì„¤ì •                                              â”‚       â”‚
â”‚  â”‚    â”‚   - Gateway â†’ Service: DISABLE (í‰ë¬¸ HTTP)              â”‚       â”‚
â”‚  â”‚    â”‚   - Service â†” Service: ISTIO_MUTUAL (ì•”í˜¸í™”)           â”‚       â”‚
â”‚  â”‚    â”œâ”€ Connection Pool                                        â”‚       â”‚
â”‚  â”‚    â”‚   - http1MaxPendingRequests: 100                        â”‚       â”‚
â”‚  â”‚    â”‚   - maxConnections: 100                                 â”‚       â”‚
â”‚  â”‚    â”œâ”€ Load Balancing                                         â”‚       â”‚
â”‚  â”‚    â”‚   - simple: ROUND_ROBIN                                 â”‚       â”‚
â”‚  â”‚    â”œâ”€ Outlier Detection (Circuit Breaker)                    â”‚       â”‚
â”‚  â”‚    â”‚   - consecutive5xxErrors: 5                             â”‚       â”‚
â”‚  â”‚    â”‚   - baseEjectionTime: 30s                               â”‚       â”‚
â”‚  â”‚    â””â”€ Subset ì •ì˜                                            â”‚       â”‚
â”‚  â”‚        - stable: Argo Rollouts stable Pod                    â”‚       â”‚
â”‚  â”‚        - canary: Argo Rollouts canary Pod                    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 4. Envoy Sidecar Proxy (ê° Podì— ì£¼ì…)                      â”‚       â”‚
â”‚  â”‚    â”œâ”€ mTLS ì•”í˜¸í™”/ë³µí˜¸í™”                                     â”‚       â”‚
â”‚  â”‚    â”œâ”€ Load Balancing (ClusterIP ë‚´ë¶€)                       â”‚       â”‚
â”‚  â”‚    â”œâ”€ Retry, Timeout ì ìš©                                    â”‚       â”‚
â”‚  â”‚    â”œâ”€ Circuit Breaker ë™ì‘                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ Metrics ìˆ˜ì§‘ (Prometheus)                             â”‚       â”‚
â”‚  â”‚    â””â”€ Distributed Tracing (Jaeger)                          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Istioê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥**:

| ê¸°ëŠ¥ | ì„¤ëª… | í˜„ì¬ ì‚¬ìš© ì—¬ë¶€ |
|------|------|---------------|
| **L7 Routing** | URI, Header, Method ê¸°ë°˜ ë¼ìš°íŒ… | âœ… ì‚¬ìš© (VirtualService) |
| **Canary ë°°í¬** | íŠ¸ë˜í”½ ë¶„ì‚° (10% â†’ 50% â†’ 90%) | âœ… ì‚¬ìš© (Argo Rollouts ì—°ë™) |
| **mTLS** | Service ê°„ ì•”í˜¸í™” í†µì‹  | âœ… ì‚¬ìš© (PERMISSIVE ëª¨ë“œ) |
| **Retry** | ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì‹œë„ | âœ… ì‚¬ìš© (3 attempts) |
| **Timeout** | ìš”ì²­ íƒ€ì„ì•„ì›ƒ ì„¤ì • | âœ… ì‚¬ìš© (5s) |
| **Circuit Breaker** | ì¥ì•  Pod ìë™ ê²©ë¦¬ | âœ… ì‚¬ìš© (5xx ì—ëŸ¬ 5íšŒ) |
| **Load Balancing** | Pod ê°„ íŠ¸ë˜í”½ ë¶„ì‚° | âœ… ì‚¬ìš© (ROUND_ROBIN) |
| **Distributed Tracing** | ìš”ì²­ ì¶”ì  (Jaeger) | âœ… ì„¤ì¹˜ë¨ (ë¯¸ì‚¬ìš©) |
| **Metrics** | Prometheus ë©”íŠ¸ë¦­ | âœ… ì‚¬ìš© (Grafana ëŒ€ì‹œë³´ë“œ) |

**Istioê°€ ë‹´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒ**:

- âŒ L3/L4 ë„¤íŠ¸ì›Œí‚¹ (Pod IP í• ë‹¹, ë¼ìš°íŒ…) â†’ **Cilium CNIê°€ ë‹´ë‹¹**
- âŒ NetworkPolicy ì ìš© â†’ **Ciliumì´ ë‹´ë‹¹**
- âŒ LoadBalancer IP í• ë‹¹ (192.168.1.200) â†’ **MetalLBê°€ ë‹´ë‹¹**
- âŒ DNS í•´ì„ (ClusterIP â†’ Pod IP) â†’ **CoreDNS + Ciliumì´ ë‹´ë‹¹**

---

### 3. Cilium CNI ì—­í• 

**Ciliumì´ ë‹´ë‹¹í•˜ëŠ” ê³„ì¸µ: L3/L4 (Network + Transport Layer)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cilium eBPF ê¸°ë°˜ CNI                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 1. CNI (Container Network Interface)                         â”‚       â”‚
â”‚  â”‚    â”œâ”€ ëª¨ë“  Podì— IP ì£¼ì†Œ í• ë‹¹ (IPAM)                        â”‚       â”‚
â”‚  â”‚    â”‚   - blog-system/web-xxx: 10.0.1.15                      â”‚       â”‚
â”‚  â”‚    â”‚   - blog-system/was-xxx: 10.0.1.16                      â”‚       â”‚
â”‚  â”‚    â”‚   - blog-system/mysql-xxx: 10.0.1.17                    â”‚       â”‚
â”‚  â”‚    â”œâ”€ Pod ê°„ í†µì‹  (eBPF ê¸°ë°˜)                                â”‚       â”‚
â”‚  â”‚    â”‚   - Linux Bridge ëŒ€ì‹  eBPF ì‚¬ìš© (ê³ ì„±ëŠ¥)               â”‚       â”‚
â”‚  â”‚    â”‚   - ì»¤ë„ ë°”ì´íŒ¨ìŠ¤ (ë‚®ì€ ë ˆì´í„´ì‹œ)                       â”‚       â”‚
â”‚  â”‚    â””â”€ Overlay Network (VXLAN)                                â”‚       â”‚
â”‚  â”‚        - Node ê°„ í†µì‹  (ë‹¤ë¥¸ Workerë¡œ íŒ¨í‚· ì „ë‹¬)             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 2. Service Load Balancing (eBPF)                             â”‚       â”‚
â”‚  â”‚    â”œâ”€ ClusterIP â†’ Pod IP ë³€í™˜                                â”‚       â”‚
â”‚  â”‚    â”‚   - web-service:80 â†’ 10.0.1.15:80                       â”‚       â”‚
â”‚  â”‚    â”‚   - was-service:8080 â†’ 10.0.1.16:8080                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ eBPF kprobeë¡œ íŒ¨í‚· ê°€ë¡œì±„ê¸°                            â”‚       â”‚
â”‚  â”‚    â”‚   - connect() syscall í›„í‚¹                              â”‚       â”‚
â”‚  â”‚    â”‚   - DNAT ì ìš© (Destination IP ë³€ê²½)                     â”‚       â”‚
â”‚  â”‚    â””â”€ ê³ ì„±ëŠ¥ ì²˜ë¦¬ (iptables ëŒ€ë¹„ 10ë°° ë¹ ë¦„)                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 3. NetworkPolicy ì—”ì§„ (ë³´ì•ˆ ì •ì±… ì ìš©)                       â”‚       â”‚
â”‚  â”‚    â”œâ”€ Kubernetes NetworkPolicy ì§€ì›                         â”‚       â”‚
â”‚  â”‚    â”œâ”€ Falco Talon IPS í†µí•©                                   â”‚       â”‚
â”‚  â”‚    â”‚   - CRITICAL ì´ë²¤íŠ¸ ë°œìƒ ì‹œ                             â”‚       â”‚
â”‚  â”‚    â”‚   - NetworkPolicy ìë™ ìƒì„±                             â”‚       â”‚
â”‚  â”‚    â”‚   - Pod Ingress/Egress ì°¨ë‹¨                             â”‚       â”‚
â”‚  â”‚    â”œâ”€ eBPF ê¸°ë°˜ íŒ¨í‚· í•„í„°ë§                                  â”‚       â”‚
â”‚  â”‚    â”‚   - í—ˆìš© ëª©ë¡ ê¸°ë°˜ (Allow-list)                         â”‚       â”‚
â”‚  â”‚    â”‚   - ì»¤ë„ ë ˆë²¨ ì°¨ë‹¨ (ìš°íšŒ ë¶ˆê°€)                          â”‚       â”‚
â”‚  â”‚    â””â”€ Hubble ì‹œê°í™”                                          â”‚       â”‚
â”‚  â”‚        - Network Flow ì¶”ì                                    â”‚       â”‚
â”‚  â”‚        - Policy ì ìš© ì—¬ë¶€ í™•ì¸                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                            â†“                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 4. Hubble (Network Observability)                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Network Flow ì‹œê°í™”                                    â”‚       â”‚
â”‚  â”‚    â”œâ”€ DNS ìš”ì²­ ì¶”ì                                           â”‚       â”‚
â”‚  â”‚    â”œâ”€ HTTP/HTTPS íŠ¸ë˜í”½ ë¶„ì„                                 â”‚       â”‚
â”‚  â”‚    â””â”€ Service Dependency Map                                 â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ciliumì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥**:

| ê¸°ëŠ¥ | ì„¤ëª… | í˜„ì¬ ì‚¬ìš© ì—¬ë¶€ |
|------|------|---------------|
| **CNI** | Pod IP í• ë‹¹, Pod ê°„ í†µì‹  | âœ… ì‚¬ìš© (ëª¨ë“  Pod) |
| **Service Load Balancing** | ClusterIP â†’ Pod IP ë³€í™˜ | âœ… ì‚¬ìš© (eBPF ê¸°ë°˜) |
| **NetworkPolicy** | Pod ê²©ë¦¬, íŠ¸ë˜í”½ ì œì–´ | âœ… ì‚¬ìš© (Falco Talon ì—°ë™) |
| **Hubble** | Network Flow ì‹œê°í™” | â³ ì„¤ì¹˜ë¨ (ë¯¸í™œì„±í™”) |
| **BPF Maps** | ê³ ì„±ëŠ¥ íŒ¨í‚· ì²˜ë¦¬ | âœ… ì‚¬ìš© (ìë™) |

**Ciliumê³¼ Istioì˜ ì—­í•  êµ¬ë¶„**:

| ê³„ì¸µ | ë‹´ë‹¹ | Cilium | Istio |
|------|------|--------|-------|
| **L3 (Network)** | Pod IP í• ë‹¹, ë¼ìš°íŒ… | âœ… Cilium | âŒ |
| **L4 (Transport)** | TCP/UDP ì—°ê²°, Port | âœ… Cilium | âŒ |
| **L4 Load Balancing** | ClusterIP â†’ Pod IP | âœ… Cilium (eBPF) | âŒ |
| **L7 (Application)** | HTTP Routing, Retry | âŒ | âœ… Istio |
| **L7 Load Balancing** | Canary ë°°í¬ (%) | âŒ | âœ… Istio |
| **mTLS** | Service ê°„ ì•”í˜¸í™” | âŒ | âœ… Istio |
| **NetworkPolicy** | Pod ê²©ë¦¬ | âœ… Cilium | âŒ |

**ì‹¤ì œ íŠ¸ë˜í”½ í”Œë¡œìš° ì˜ˆì‹œ**:

```
ì‚¬ìš©ì ìš”ì²­: https://blog.jiminhome.shop/api/posts
  â†“
Istio Gateway (L7 Routing)
  â”œâ”€ VirtualService: /api/** â†’ was-service:8080 ë§¤ì¹­
  â””â”€ DestinationRule: subset stable ì„ íƒ
  â†“
Cilium (L4 Load Balancing)
  â”œâ”€ was-service:8080 (ClusterIP 10.96.10.20)
  â”œâ”€ eBPF kprobeë¡œ DNAT ì ìš©
  â””â”€ Pod IP 10.0.1.16:8080ìœ¼ë¡œ ë³€í™˜
  â†“
WAS Pod (Envoy Sidecar â†’ Spring Boot Container)
  â”œâ”€ Envoy: mTLS ë³µí˜¸í™”, Metrics ìˆ˜ì§‘
  â””â”€ Spring Boot: @GetMapping("/api/posts") ì²˜ë¦¬
  â†“
MySQL (Cilium ê²½ìœ , Istio mesh ì œì™¸)
  â””â”€ mysql-service:3306 (ClusterIP 10.96.10.30)
  â””â”€ Cilium eBPF: Pod IP 10.0.1.17:3306ìœ¼ë¡œ ë³€í™˜
```

---

### ì „ì²´ ì‹œìŠ¤í…œ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kubernetes Cluster (v1.31.13)                                            â”‚
â”‚ Nodes: 4 (1 CP + 3 Workers)                                              â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Istio Service Mesh (mTLS PERMISSIVE)                               â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ VirtualService (blog-virtualservice)                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Route: / â†’ web-service (ì •ì  ì½˜í…ì¸ )                 â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ Route: /api/** â†’ was-service (API)                    â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚ â”‚
â”‚  â”‚           â”‚                           â”‚                             â”‚ â”‚
â”‚  â”‚           â†“                           â†“                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚  â”‚  â”‚ WEB              â”‚        â”‚ WAS              â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ (Argo Rollout)   â”‚        â”‚ (Argo Rollout)   â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚        â”‚                  â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ nginx:alpine â”‚ â”‚  mTLS  â”‚ â”‚ Spring Boot  â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Hugo ì •ì     â”‚ â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”‚ board-was    â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚              â”‚ â”‚  ğŸ”’    â”‚ â”‚              â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ CPU: 100m    â”‚ â”‚        â”‚ â”‚ CPU: 250m    â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Mem: 128Mi   â”‚ â”‚        â”‚ â”‚ Mem: 512Mi   â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ Replicas:2-5 â”‚ â”‚        â”‚ â”‚ Replicas:2-10â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â”‚ (HPA 60%)    â”‚ â”‚        â”‚ â”‚ (HPA 70%)    â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚        â”‚        â”‚         â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ SecurityContext: â”‚        â”‚        â”‚         â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ - runAsNonRoot  â”‚        â”‚        â”‚         â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ - drop ALL caps â”‚        â”‚        â”‚         â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ - Private GHCR  â”‚        â”‚        â”‚         â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚        â”‚        â†“         â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ Canary ë°°í¬ âœ…  â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ (10%â†’50%â†’90%)   â”‚        â”‚ â”‚ MySQL 8.0    â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ Istio Traffic   â”‚        â”‚ â”‚              â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â”‚ Splitting       â”‚        â”‚ â”‚ CPU: 200m    â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚ Mem: 512Mi   â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ PVC: 5Gi     â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ (Longhorn)   â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚              â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ Storage:     â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ - Replica: 3 â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ - S3 Backup  â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚   (daily 3AM)â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ - RTO: 5ë¶„   â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â”‚ - RPO: 24h   â”‚ â”‚                  â”‚ â”‚
â”‚  â”‚                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                  â”‚ â”‚
â”‚  â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ë³´ì•ˆ ê³„ì¸µ (Falco Runtime Security)                                 â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ Falco DaemonSet (ëª¨ë“  ë…¸ë“œì— ë°°í¬)                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ eBPF Probe: syscall ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ íƒì§€ ê·œì¹™: CVE, RCE, Reverse Shell, Privilege Esc   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ ëª¨ë‹ˆí„°ë§: ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ì´ìƒ í–‰ìœ„                 â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚           â”‚ ì´ìƒ íƒì§€ ì‹œ                                            â”‚ â”‚
â”‚  â”‚           â†“                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ Falcosidekick (Alert Routing Hub)                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Lokië¡œ Alert ì „ì†¡ (ì¥ê¸° ë³´ê´€)                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ Falco Talonìœ¼ë¡œ Alert ì „ë‹¬ (ìë™ ëŒ€ì‘)              â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚           â”‚                                                          â”‚ â”‚
â”‚  â”‚           â†“                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ Falco Talon (IPS - Intrusion Prevention System)           â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ ëª¨ë“œ: Dry-Run Phase 1 (1ì£¼ê°„ í•™ìŠµ)                   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Action: NetworkPolicy ê¸°ë°˜ Pod ê²©ë¦¬                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”‚   - CRITICAL ì´ë²¤íŠ¸ â†’ ì¦‰ì‹œ ê²©ë¦¬                       â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”‚   - Ingress/Egress íŠ¸ë˜í”½ ì°¨ë‹¨                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ í–¥í›„ ê³„íš: Phase 2 ìë™ ì°¨ë‹¨ í™œì„±í™”                 â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ëª¨ë‹ˆí„°ë§ & ë¡œê¹… (PLG Stack)                                        â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ Prometheus (ë©”íŠ¸ë¦­ ìˆ˜ì§‘)                                  â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Node Exporter (ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­)                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ MySQL Exporter (DB ë©”íŠ¸ë¦­)                           â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Pushgateway (CI/CD ë©”íŠ¸ë¦­)                           â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ Istio Telemetry (Service Mesh ë©”íŠ¸ë¦­)               â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ Loki (ë¡œê·¸ ìˆ˜ì§‘ & ê²€ìƒ‰)                                   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ ëª¨ë“  Pod ë¡œê·¸ ìˆ˜ì§‘ (Promtail)                        â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Falco Alert ìˆ˜ì§‘ (ë³´ì•ˆ ì´ë²¤íŠ¸)                      â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Retention: 7ì¼ (168h) âœ… 2026-01-23 ì ìš©            â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ê´€ë¦¬ (ìë™ ì‚­ì œ)                      â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ Grafana (í†µí•© ëŒ€ì‹œë³´ë“œ)                                   â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Prometheus Datasource (ë©”íŠ¸ë¦­ ì‹œê°í™”)               â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€ Loki Datasource (ë¡œê·¸ ë¶„ì„)                          â”‚    â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ Pre-configured Dashboards (K8s, MySQL, Istio)       â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GitOps ë°°í¬ (ArgoCD)                                               â”‚ â”‚
â”‚  â”‚   â”œâ”€ Git Repo: github.com/wlals2/k8s-manifests                     â”‚ â”‚
â”‚  â”‚   â”œâ”€ Auto-Sync: 3ì´ˆ ì´ë‚´ ê°ì§€                                      â”‚ â”‚
â”‚  â”‚   â”œâ”€ Self-Heal: kubectl ìˆ˜ì • â†’ Git ìƒíƒœë¡œ ë³µêµ¬                    â”‚ â”‚
â”‚  â”‚   â””â”€ Argo Rollouts: Canary ë°°í¬ ìë™í™”                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ìŠ¤í† ë¦¬ì§€ (Longhorn)                                                â”‚ â”‚
â”‚  â”‚   â”œâ”€ CSI Driver: ë™ì  PV í”„ë¡œë¹„ì €ë‹                               â”‚ â”‚
â”‚  â”‚   â”œâ”€ Replica Count: 3 (worker1, worker2, worker3)                 â”‚ â”‚
â”‚  â”‚   â”œâ”€ Automatic Failover: ë…¸ë“œ ì¥ì•  ì‹œ ìë™ ë³µêµ¬                   â”‚ â”‚
â”‚  â”‚   â””â”€ Backup: S3 (ë§¤ì¼ 03:00 KST)                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CNI (Cilium v1.18.4)                                               â”‚ â”‚
â”‚  â”‚   â”œâ”€ eBPF ê¸°ë°˜ ë„¤íŠ¸ì›Œí‚¹                                            â”‚ â”‚
â”‚  â”‚   â”œâ”€ NetworkPolicy ì§€ì› (Falco Talon í†µí•©)                        â”‚ â”‚
â”‚  â”‚   â”œâ”€ Service Load Balancing                                        â”‚ â”‚
â”‚  â”‚   â””â”€ Hubble: Network Observability                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë³´ì•ˆ ì´ë²¤íŠ¸ í”Œë¡œìš° (Falco IDS/IPS)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. íƒì§€ (Detection)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Falco DaemonSet (ëª¨ë“  ë…¸ë“œ)                                 â”‚
   â”‚   â””â”€ eBPF syscall ëª¨ë‹ˆí„°ë§                                 â”‚
   â”‚      - ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ (reverse shell)            â”‚
   â”‚      - ë¯¼ê°í•œ íŒŒì¼ ì ‘ê·¼ (/etc/shadow)                      â”‚
   â”‚      - ê¶Œí•œ ìƒìŠ¹ ì‹œë„ (setuid)                             â”‚
   â”‚      - ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì´ìƒ (unknown IP)                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“ Alert ìƒì„± (JSON)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Falcosidekick (Alert Routing Hub)                           â”‚
   â”‚   â”œâ”€ Priority í•„í„°ë§ (CRITICAL, WARNING, INFO)             â”‚
   â”‚   â””â”€ 2ê°œ ê²½ë¡œë¡œ Alert ì „ì†¡:                                â”‚
   â”‚      1. Loki â†’ ì¥ê¸° ë³´ê´€ & ë¶„ì„                            â”‚
   â”‚      2. Falco Talon â†’ ìë™ ëŒ€ì‘                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                    â”‚
          â†“ (ë¡œê·¸ ë³´ê´€)                        â†“ (ìë™ ëŒ€ì‘)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Loki         â”‚                  â”‚ Falco Talon (IPS)       â”‚
   â”‚ - 7ì¼ ë³´ê´€   â”‚                  â”‚ - Dry-Run Phase 1       â”‚
   â”‚ - Grafana    â”‚                  â”‚ - CRITICAL ì´ë²¤íŠ¸ë§Œ     â”‚
   â”‚   ì‹œê°í™”     â”‚                  â”‚                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â†“ NetworkPolicy ìƒì„±
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Kubernetes API                                              â”‚
   â”‚   â””â”€ NetworkPolicy ì ìš©:                                   â”‚
   â”‚      - Ingress: DENY ALL (ì™¸ë¶€ â†’ Pod ì°¨ë‹¨)                â”‚
   â”‚      - Egress: DENY ALL (Pod â†’ ì™¸ë¶€ ì°¨ë‹¨)                 â”‚
   â”‚      - Pod ì™„ì „ ê²©ë¦¬ (ê²©ë¦¬ë§Œ, ì¢…ë£Œ ì•ˆ í•¨)                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“ ê²°ê³¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ íš¨ê³¼: ê³µê²©ì Pod ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬                             â”‚
   â”‚   - ì™¸ë¶€ í†µì‹  ì°¨ë‹¨ (C2 ì„œë²„ ì—°ê²° ë¶ˆê°€)                     â”‚
   â”‚   - ë‚´ë¶€ í™•ì‚° ë°©ì§€ (ë‹¤ë¥¸ Pod ì ‘ê·¼ ë¶ˆê°€)                    â”‚
   â”‚   - ê´€ë¦¬ì ìˆ˜ë™ ì¡°ì‚¬ ê°€ëŠ¥ (PodëŠ” Running ìƒíƒœ ìœ ì§€)        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. CI/CD íŒŒì´í”„ë¼ì¸ (GitOps)

**GitHub Actions â†’ GHCR â†’ ArgoCD â†’ Canary ë°°í¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CI/CD íŒŒì´í”„ë¼ì¸ (WEB ë°°í¬ í”Œë¡œìš°)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Step 1: Developer (ì½”ë“œ ì‘ì„± & Push)                         â”‚       â”‚
â”‚  â”‚    â”œâ”€ ~/blogsite/content/posts/new-post.md (ë¸”ë¡œê·¸ ê¸€ ì‘ì„±) â”‚       â”‚
â”‚  â”‚    â”œâ”€ git add, git commit                                    â”‚       â”‚
â”‚  â”‚    â””â”€ git push origin main                                   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚ GitHub Webhook                                â”‚
â”‚                         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Step 2: GitHub Actions (Self-Hosted Runner)                 â”‚       â”‚
â”‚  â”‚    â”œâ”€ Trigger: push to main                                 â”‚       â”‚
â”‚  â”‚    â”œâ”€ Runner: ~/actions-runner (ë¡œì»¬ ì„œë²„)                  â”‚       â”‚
â”‚  â”‚    â””â”€ Workflow: .github/workflows/deploy-web.yml            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚                                                â”‚
â”‚                         â†“ Job 1: Build                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Hugo Build                                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ hugo --minify                                          â”‚       â”‚
â”‚  â”‚    â”œâ”€ Output: public/ (ì •ì  íŒŒì¼)                            â”‚       â”‚
â”‚  â”‚    â””â”€ Size: ~10MB (HTML, CSS, JS, ì´ë¯¸ì§€)                   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Docker Build (Multi-stage)                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ Stage 1: Hugo Builder (klakegg/hugo:0.111.3)          â”‚       â”‚
â”‚  â”‚    â”œâ”€ Stage 2: nginx:alpine + static files                  â”‚       â”‚
â”‚  â”‚    â”œâ”€ Image Tag: blog-web:v${GITHUB_RUN_NUMBER}             â”‚       â”‚
â”‚  â”‚    â””â”€ Image Size: 74MB                                       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚                                                â”‚
â”‚                         â†“ Job 2: Push to Registry                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ GitHub Container Registry (GHCR)                             â”‚       â”‚
â”‚  â”‚    â”œâ”€ Login: ghcr.io (GitHub PAT)                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Push: ghcr.io/wlals2/blog-web:v60                     â”‚       â”‚
â”‚  â”‚    â”œâ”€ Private Registry (imagePullSecrets í•„ìš”)              â”‚       â”‚
â”‚  â”‚    â””â”€ Verification: ì´ë¯¸ì§€ í¬ê¸° 10-200MB ì²´í¬               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚                                                â”‚
â”‚                         â†“ Job 3: GitOps Manifest Update                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ k8s-manifests Repository ì—…ë°ì´íŠ¸                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Clone: ~/k8s-manifests/                               â”‚       â”‚
â”‚  â”‚    â”œâ”€ Update: blog-system/web-rollout.yaml                  â”‚       â”‚
â”‚  â”‚    â”‚   - image: ghcr.io/wlals2/blog-web:v60                 â”‚       â”‚
â”‚  â”‚    â”œâ”€ git commit -m "deploy: web v60"                       â”‚       â”‚
â”‚  â”‚    â””â”€ git push                                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚ Git Push Event                                â”‚
â”‚                         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Step 3: ArgoCD (Auto-Sync)                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ Poll Interval: 3ì´ˆ                                     â”‚       â”‚
â”‚  â”‚    â”œâ”€ Git Diff ê°ì§€: web-rollout.yaml ë³€ê²½                 â”‚       â”‚
â”‚  â”‚    â”œâ”€ Sync Policy: Automated                                â”‚       â”‚
â”‚  â”‚    â””â”€ Apply: kubectl apply -f web-rollout.yaml              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚                                                â”‚
â”‚                         â†“ Kubernetes Apply                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Step 4: Argo Rollouts (Canary ë°°í¬)                          â”‚       â”‚
â”‚  â”‚    â”œâ”€ Phase 1: Canary Pod ìƒì„± (v60)                        â”‚       â”‚
â”‚  â”‚    â”‚   - Replicas: 1 (10% íŠ¸ë˜í”½)                           â”‚       â”‚
â”‚  â”‚    â”‚   - Subset: canary                                      â”‚       â”‚
â”‚  â”‚    â”œâ”€ Phase 2: Istio VirtualService ì—…ë°ì´íŠ¸                â”‚       â”‚
â”‚  â”‚    â”‚   - stable: 90%, canary: 10%                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Pause: 30ì´ˆ (Health Check)                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Phase 3: íŠ¸ë˜í”½ ì¦ê°€                                   â”‚       â”‚
â”‚  â”‚    â”‚   - stable: 50%, canary: 50%                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Pause: 30ì´ˆ                                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Phase 4: íŠ¸ë˜í”½ ì¦ê°€                                   â”‚       â”‚
â”‚  â”‚    â”‚   - stable: 10%, canary: 90%                            â”‚       â”‚
â”‚  â”‚    â”œâ”€ Pause: 30ì´ˆ                                            â”‚       â”‚
â”‚  â”‚    â””â”€ Phase 5: Stable ì „í™˜                                   â”‚       â”‚
â”‚  â”‚        - Canary â†’ Stable (100%)                              â”‚       â”‚
â”‚  â”‚        - ê¸°ì¡´ Stable Pod ì‚­ì œ                                â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚                                                â”‚
â”‚                         â†“ Post-Deployment                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Step 5: Cloudflare Cache Purge                               â”‚       â”‚
â”‚  â”‚    â”œâ”€ API Call: Cloudflare Zone API                         â”‚       â”‚
â”‚  â”‚    â”œâ”€ Action: purge_everything                              â”‚       â”‚
â”‚  â”‚    â””â”€ Result: CDN ìºì‹œ ì™„ì „ ì‚­ì œ                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Step 6: Email Notification                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ To: fw4568@gmail.com                                   â”‚       â”‚
â”‚  â”‚    â”œâ”€ Subject: "[Success] blog-web v60 deployed"            â”‚       â”‚
â”‚  â”‚    â””â”€ Body:                                                  â”‚       â”‚
â”‚  â”‚        - Image: ghcr.io/wlals2/blog-web:v60                 â”‚       â”‚
â”‚  â”‚        - Size: 74MB                                          â”‚       â”‚
â”‚  â”‚        - Canary: 10% â†’ 50% â†’ 90% â†’ 100%                     â”‚       â”‚
â”‚  â”‚        - Duration: ~2ë¶„                                      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CI/CD íŠ¹ì§•**:

| í•­ëª© | WEB (Hugo) | WAS (Spring Boot) |
|------|-----------|-------------------|
| **íŠ¸ë¦¬ê±°** | git push main (ìë™) | workflow_dispatch (ìˆ˜ë™) |
| **ë¹Œë“œ ë„êµ¬** | Hugo + Docker | Maven + Docker |
| **ë°°í¬ ì „ëµ** | Canary (Argo Rollouts) | Canary (Argo Rollouts) |
| **ë°°í¬ ì‹œê°„** | ~2ë¶„ | ~3ë¶„ |
| **Rollback** | Argo Rollouts CLI | Argo Rollouts CLI |
| **Canary ë‹¨ê³„** | 10% â†’ 50% â†’ 90% â†’ 100% | 20% â†’ 50% â†’ 80% â†’ 100% |
| **Health Check** | HTTP 200 OK (/) | Actuator (/actuator/health) |
| **Metrics ìˆ˜ì§‘** | Pushgateway (ë¹Œë“œ ì‹œê°„) | Pushgateway (ë¹Œë“œ ì‹œê°„) |
| **ì•Œë¦¼** | Email (ì„±ê³µ/ì‹¤íŒ¨) | Email (ì„±ê³µ/ì‹¤íŒ¨) |

**GitOps ì›ì¹™**:

1. **Git = Single Source of Truth**
   - ëª¨ë“  manifestëŠ” k8s-manifests Git repoì— ì €ì¥
   - kubectl ì§ì ‘ ìˆ˜ì • ê¸ˆì§€ (ArgoCD selfHealë¡œ ë˜ëŒë ¤ì§)
   - ë³€ê²½ ì´ë ¥ Gitìœ¼ë¡œ ì¶”ì  ê°€ëŠ¥

2. **Declarative**
   - Desired Stateë¥¼ YAMLë¡œ ì„ ì–¸
   - ArgoCDê°€ Current State â†’ Desired Stateë¡œ ìë™ ì¡°ì •

3. **Automated**
   - Git push â†’ ArgoCD Auto-Sync (3ì´ˆ ë‚´)
   - Manual intervention ë¶ˆí•„ìš”

4. **Self-Healing**
   - kubectl edit ì‹œë„ â†’ ArgoCDê°€ Git ìƒíƒœë¡œ ë³µêµ¬
   - Pod ì‚­ì œ â†’ Kubernetesê°€ ìë™ ì¬ìƒì„±

**Rollback ì‹œë‚˜ë¦¬ì˜¤**:

```bash
# ë¬¸ì œ ë°œìƒ ì‹œ (v60ì—ì„œ 500 ì—ëŸ¬ ë°œìƒ)
kubectl argo rollouts abort web -n blog-system

# ì´ì „ ë²„ì „ìœ¼ë¡œ ì¦‰ì‹œ ë³µêµ¬ (v59)
kubectl argo rollouts undo web -n blog-system

# ë˜ëŠ” Gitì—ì„œ ì§ì ‘ Revert
cd ~/k8s-manifests
git revert HEAD  # web-rollout.yaml ë³€ê²½ ì·¨ì†Œ
git push         # ArgoCDê°€ v59ë¡œ ìë™ ë³µêµ¬
```

---

### 5. ê³ ê°€ìš©ì„± (HA) ì•„í‚¤í…ì²˜

**ë…¸ë“œ ì¥ì•  ì‹œ Failover ë©”ì»¤ë‹ˆì¦˜**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3-Worker í´ëŸ¬ìŠ¤í„° êµ¬ì„±                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ k8s-worker1   â”‚   â”‚ k8s-worker2   â”‚   â”‚ k8s-worker3   â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ WEB Pod A     â”‚   â”‚ WEB Pod B     â”‚   â”‚ WEB Pod C     â”‚             â”‚
â”‚  â”‚ WAS Pod A     â”‚   â”‚ WAS Pod B     â”‚   â”‚ WAS Pod C     â”‚             â”‚
â”‚  â”‚ MySQL Pod     â”‚   â”‚               â”‚   â”‚               â”‚             â”‚
â”‚  â”‚ Longhorn      â”‚   â”‚ Longhorn      â”‚   â”‚ Longhorn      â”‚             â”‚
â”‚  â”‚ Replica 1     â”‚   â”‚ Replica 2     â”‚   â”‚ Replica 3     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â†‘                    â†‘                    â†‘                      â”‚
â”‚         â””â”€â”€â”€â”€â”€topologySpreadConstraintsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                (Podë¥¼ Worker ë…¸ë“œì— ê· ë“± ë¶„ì‚°)                           â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ 1: Stateless Pod ì¥ì•  (WEB, WAS)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Worker1 Down âŒ                                                         â”‚
â”‚  â”œâ”€ WEB Pod A ì¤‘ë‹¨ (but WEB Pod B, CëŠ” ì •ìƒ)                           â”‚
â”‚  â”œâ”€ WAS Pod A ì¤‘ë‹¨ (but WAS Pod B, CëŠ” ì •ìƒ)                           â”‚
â”‚  â””â”€ Istio Gateway â†’ ì •ìƒ Podë¡œ íŠ¸ë˜í”½ ì „ë‹¬                             â”‚
â”‚                                                                          â”‚
â”‚  â±ï¸ ë‹¤ìš´íƒ€ì„: 0ì´ˆ                                                        â”‚
â”‚  â”œâ”€ ì´ìœ : topologySpreadConstraintsë¡œ ë¯¸ë¦¬ ë¶„ì‚°                         â”‚
â”‚  â””â”€ íš¨ê³¼: ì‚¬ìš©ìëŠ” ì¥ì• ë¥¼ ì¸ì§€í•˜ì§€ ëª»í•¨                                 â”‚
â”‚                                                                          â”‚
â”‚  5ë¶„ í›„ (Kubernetes Taint ì ìš©):                                        â”‚
â”‚  â”œâ”€ Worker1ì˜ Podë“¤ Eviction                                            â”‚
â”‚  â”œâ”€ Worker2, Worker3ì— ì¬ìƒì„±                                           â”‚
â”‚  â””â”€ Replicas ìœ ì§€ (WEB: 3, WAS: 3)                                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ 2: Stateful Pod ì¥ì•  (MySQL + Longhorn)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Worker1 Down âŒ (MySQL Pod í¬í•¨)                                       â”‚
â”‚  â”œâ”€ MySQL Pod ì¤‘ë‹¨                                                      â”‚
â”‚  â”œâ”€ Longhorn Manager ê°ì§€ (30ì´ˆ ì´ë‚´)                                  â”‚
â”‚  â””â”€ nodeDownPodDeletionPolicy: delete-both                              â”‚
â”‚                                                                          â”‚
â”‚  30ì´ˆ~2ë¶„ í›„:                                                            â”‚
â”‚  â”œâ”€ MySQL Pod ê°•ì œ ì‚­ì œ                                                 â”‚
â”‚  â”œâ”€ Worker2 ë˜ëŠ” Worker3ì— ì¬ìƒì„±                                      â”‚
â”‚  â”œâ”€ Longhorn Replica 2 ë˜ëŠ” 3ì—ì„œ ë°ì´í„° ë³µêµ¬                          â”‚
â”‚  â””â”€ PVC ë§ˆìš´íŠ¸ (ë™ì¼í•œ ë°ì´í„°)                                         â”‚
â”‚                                                                          â”‚
â”‚  â±ï¸ ë‹¤ìš´íƒ€ì„: 30ì´ˆ~2ë¶„                                                   â”‚
â”‚  â”œâ”€ RTO: 2ë¶„ (Recovery Time Objective)                                 â”‚
â”‚  â”œâ”€ RPO: 0ì´ˆ (Recovery Point Objective)                                â”‚
â”‚  â””â”€ ë°ì´í„° ì†ì‹¤: ì—†ìŒ (Replica 3ê°œ ì¤‘ 2ê°œ ì •ìƒ)                        â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**topologySpreadConstraints ì„¤ì •**:

```yaml
# web-rollout.yaml
spec:
  template:
    spec:
      topologySpreadConstraints:
      - maxSkew: 1  # Worker ë…¸ë“œ ê°„ Pod ìˆ˜ ì°¨ì´ ìµœëŒ€ 1
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: ScheduleAnyway  # 3-worker í´ëŸ¬ìŠ¤í„°ì— ë§ì¶¤
        labelSelector:
          matchLabels:
            app: web
```

**íš¨ê³¼**:
- âœ… **3-worker í´ëŸ¬ìŠ¤í„°**: Worker1, Worker2, Worker3ì— ê°ê° 1ê°œì”© ë¶„ì‚°
- âœ… **ë…¸ë“œ ì¥ì•  ì‹œ ë‹¤ìš´íƒ€ì„ 0ì´ˆ**: ë‹¤ë¥¸ ë…¸ë“œì˜ Podê°€ ì¦‰ì‹œ íŠ¸ë˜í”½ ì²˜ë¦¬
- âœ… **dynamicStableScale: true**: Canary ë°°í¬ ì¤‘ì—ë„ Stable Pod ìˆ˜ ìœ ì§€

**HA ë³µêµ¬ ì‹œê°„ ë¹„êµ**:

| ì„œë¹„ìŠ¤ ìœ í˜• | ì €ì¥ì†Œ | ë³µêµ¬ ë°©ì‹ | ë‹¤ìš´íƒ€ì„ |
|-------------|--------|-----------|----------|
| **Stateless (WEB, WAS)** | ì—†ìŒ | topologySpread ì‚¬ì „ ë¶„ì‚° | **0ì´ˆ** |
| **Stateful (MySQL)** | Longhorn | Auto-Failover (Replica 3) | **30ì´ˆ~2ë¶„** |
| **Stateful (Grafana, Prometheus)** | NFS | K8s ê¸°ë³¸ (5ë¶„ Taint) | **5ë¶„** |
| **Stateless (ArgoCD, Alertmanager)** | ì—†ìŒ | K8s ê¸°ë³¸ (5ë¶„ Taint) | **5ë¶„** |

**ê°œì„  ì™„ë£Œ ì‚¬í•­ (2026-01-22)**:
- âœ… WEB/WASì— topologySpreadConstraints ì ìš© (ScheduleAnyway)
- âœ… Istio Ingress Gateway HA (replicas: 2 + topologySpread)
- âœ… dynamicStableScale: true (Canary ë°°í¬ ì¤‘ Pod ìˆ˜ ìœ ì§€)
- âœ… Longhorn Replica 3 (worker3 ì¶”ê°€ í›„)

---

## WEB (Hugo ë¸”ë¡œê·¸)

### ê°œìš”

**ëª©ì :** ì •ì  ë¸”ë¡œê·¸ í˜¸ìŠ¤íŒ… (Hugo ê¸°ë°˜)

| í•­ëª© | ê°’ |
|------|-----|
| **Source** | ~/blogsite/ |
| **Framework** | Hugo (PaperMod í…Œë§ˆ) |
| **Build** | `hugo --minify` |
| **Server** | nginx:alpine |
| **Image** | ghcr.io/wlals2/blog-web:v60 (Private GHCR) |
| **Image Size** | 74MB |
| **Deployment** | Argo Rollout (Canary) |
| **Replicas** | 2-5 (HPA) |
| **HPA** | CPU 60% ê¸°ì¤€ Auto Scaling |
| **imagePullSecrets** | ghcr-secret (Private Registry ì¸ì¦) |
| **Service** | ClusterIP (web-service:80) |

### Canary ë°°í¬

```yaml
# Argo Rollouts ì„¤ì •
strategy:
  canary:
    steps:
    - setWeight: 10  # 10% íŠ¸ë˜í”½ â†’ Canary
    - pause: {duration: 30s}
    - setWeight: 50  # 50% íŠ¸ë˜í”½
    - pause: {duration: 30s}
    - setWeight: 90  # 90% íŠ¸ë˜í”½
    - pause: {duration: 30s}
    # 100% â†’ Stable ì „í™˜

    # Istio Traffic Splitting
    trafficRouting:
      istio:
        virtualService:
          name: blog-virtualservice
        destinationRule:
          name: web-dest-rule
          canarySubsetName: canary
          stableSubsetName: stable
```

**íš¨ê³¼:**
- ì ì§„ì  ë°°í¬ë¡œ ìœ„í—˜ ìµœì†Œí™”
- ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ë¡¤ë°± ê°€ëŠ¥
- íŠ¸ë˜í”½ ê¸°ë°˜ A/B í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

### Dockerfile

```dockerfile
# Multi-stage Build
FROM klakegg/hugo:0.111.3-alpine AS builder
WORKDIR /src
COPY . .
RUN hugo --minify

FROM nginx:alpine
COPY --from=builder /src/public /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
```

**ìµœì í™”:**
- Multi-stage buildë¡œ ì´ë¯¸ì§€ í¬ê¸° ìµœì†Œí™” (74MB)
- Alpine Linux ì‚¬ìš©
- ë¹Œë“œ ë ˆì´ì–´ ìºì‹±

### CI/CD

**íŠ¸ë¦¬ê±°:** Git push to main

```yaml
# .github/workflows/deploy-web.yml
Steps:
1. Hugo Build â†’ Docker Image
2. Push to GHCR (ghcr.io/wlals2/blog-web:v{RUN_NUMBER})
3. Build Verification (ì´ë¯¸ì§€ í¬ê¸° 10-200MB)
4. GitOps Manifest Update (~/k8s-manifests/)
5. ArgoCD Auto-Sync (3ì´ˆ ë‚´)
6. Canary ë°°í¬ (10% â†’ 50% â†’ 90% â†’ 100%)
7. Cloudflare Cache Purge
8. Email Notification âœ…
```

**ë°°í¬ ì‹œê°„:** ì•½ 2ë¶„

---

## WAS (Spring Boot API)

### ê°œìš”

**ëª©ì :** ê²Œì‹œíŒ API ì„œë²„ (Spring Boot)

| í•­ëª© | ê°’ |
|------|-----|
| **Source** | ~/blogsite/blog-k8s-project/was/ |
| **Framework** | Spring Boot 3.x + JDK 17 |
| **Build** | Maven (mvnw clean package) |
| **Image** | ghcr.io/wlals2/board-was:v1 |
| **Image Size** | ~150MB |
| **Deployment** | Argo Rollout (Canary) |
| **Replicas** | 2 (HPA 2-10) |
| **HPA** | CPU 70%, Memory 80% |
| **Service** | ClusterIP (was-service:8080) |

### í˜„ì¬ ìƒíƒœ

```bash
# Pod ìƒíƒœ
kubectl get pods -n blog-system -l app=was
# NAME                   READY   STATUS    RESTARTS   AGE
# was-6d4949cd75-7v92l   2/2     Running   0          15h
# was-6d4949cd75-kmdxg   2/2     Running   0          15h

# HPA ìƒíƒœ
kubectl get hpa -n blog-system
# NAME      REFERENCE        TARGETS                        MINPODS   MAXPODS   REPLICAS
# was-hpa   Deployment/was   cpu: 3%/70%, memory: 48%/80%   2         10        2
```

**í˜„ì¬ ì‚¬ìš©ëŸ‰:**
- CPU: 3% (ì—¬ìœ  ì¶©ë¶„)
- Memory: 48% (ì—¬ìœ  ì¶©ë¶„)
- Replicas: 2 (ìµœì†Œê°’ ìœ ì§€ ì¤‘)

### Dockerfile

```dockerfile
# Multi-stage Build
FROM eclipse-temurin:17-jdk-alpine AS builder
WORKDIR /app
COPY .mvn .mvn
COPY mvnw pom.xml .
RUN ./mvnw dependency:go-offline
COPY src ./src
RUN ./mvnw clean package -DskipTests

FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY --from=builder /app/target/*.jar app.jar
EXPOSE 8080
HEALTHCHECK --interval=30s --timeout=3s \
  CMD wget --spider http://localhost:8080/actuator/health || exit 1
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**ë¹Œë“œ ì˜µì…˜:**
- `-DskipTests`: Docker ë¹Œë“œ í™˜ê²½ì— MySQL ì—†ìŒ â†’ í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ë°©ì§€
- í…ŒìŠ¤íŠ¸ëŠ” ë³„ë„ CI ë‹¨ê³„ì—ì„œ Testcontainers ë˜ëŠ” H2ë¡œ ì‹¤í–‰ ê¶Œì¥ (P1)

**ìµœì í™”:**
- Multi-stage build (JDK â†’ JRE)
- ì´ë¯¸ì§€ í¬ê¸°: ~150MB (JDK í¬í•¨ ì‹œ ~400MB)
- Dependency ìºì‹± ë ˆì´ì–´
- Actuator health check

### CI/CD

**íŠ¸ë¦¬ê±°:** Workflow Dispatch (ìˆ˜ë™)

```yaml
# .github/workflows/deploy-was.yml
Steps:
1. Copy WAS source from local (~/blog-k8s-project/was/)
2. Maven Build â†’ Docker Image
3. Push to GHCR
4. Build Verification (ì´ë¯¸ì§€ í¬ê¸° 50-500MB)
5. GitOps Manifest Update
6. ArgoCD Auto-Sync
7. Email Notification âœ…
```

**Note:** WAS ì½”ë“œëŠ” .gitignoreì— í¬í•¨ (ë¡œì»¬ ì „ìš©)

### í™˜ê²½ ë³€ìˆ˜

```yaml
# ConfigMap (was-config)
SPRING_DATASOURCE_URL: jdbc:mysql://mysql-service:3306/board

# Secret (was-secret)
SPRING_DATASOURCE_USERNAME: board_user
SPRING_DATASOURCE_PASSWORD: [encrypted]
```

---

## ë°ì´í„°ë² ì´ìŠ¤ (MySQL)

### ê°œìš”

| í•­ëª© | ê°’ |
|------|-----|
| **Version** | MySQL 8.0 |
| **Deployment** | Deployment (ë‹¨ì¼ Pod) |
| **Service** | ClusterIP (mysql-service:3306) |
| **Storage** | Longhorn PVC (5Gi, Replica 3) |
| **Resources** | CPU: 200m, Memory: 512Mi |
| **Monitoring** | MySQL Exporter â†’ Prometheus |
| **Istio Sidecar** | ë¹„í™œì„±í™” (JDBC í˜¸í™˜ì„±) |

### ì œì•½ì‚¬í•­

- **ë‹¨ì¼ Pod** (ê³ ê°€ìš©ì„± ì—†ìŒ)
- **ìë™ ë°±ì—…** âœ… CronJob (ë§¤ì¼ 03:00 KST) â†’ S3 ì—…ë¡œë“œ (7ì¼ Lifecycle)
- **Replication ì—†ìŒ**
- **ë³µêµ¬**: RTO 5ë¶„, RPO 24ì‹œê°„

---

## ë„¤íŠ¸ì›Œí‚¹ (Istio)

### Traffic Routing

```yaml
# VirtualService (blog-virtualservice)
spec:
  hosts:
  - blog.jiminhome.shop

  http:
  # Route 1: API íŠ¸ë˜í”½ â†’ WAS
  - match:
    - uri:
        prefix: /api/
    route:
    - destination:
        host: was-service
        port:
          number: 8080
    retries:
      attempts: 3
      perTryTimeout: 2s
    timeout: 5s

  # Route 2: ê¸°ë³¸ íŠ¸ë˜í”½ â†’ WEB (Canary)
  - route:
    - destination:
        host: web-service
        subset: stable
      weight: 90
    - destination:
        host: web-service
        subset: canary
      weight: 10  # Canary íŠ¸ë˜í”½ ë¹„ìœ¨ (Argo Rolloutsê°€ ìë™ ì¡°ì •)
```

### DestinationRule

```yaml
# WEB DestinationRule
spec:
  host: web-service
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL  # mTLS
    connectionPool:
      http:
        http1MaxPendingRequests: 100
      tcp:
        maxConnections: 100
    loadBalancer:
      simple: ROUND_ROBIN
    outlierDetection:
      consecutive5xxErrors: 5
      baseEjectionTime: 30s

  subsets:
  - name: stable
  - name: canary
```

---

## CI/CD íŒŒì´í”„ë¼ì¸

### GitOps ì›Œí¬í”Œë¡œìš°

```
Developer
  â”‚
  â”œâ”€ git push blogsite/main  â†’ WEB ìë™ ë°°í¬
  â””â”€ workflow_dispatch        â†’ WAS ìˆ˜ë™ ë°°í¬
      â†“
GitHub Actions (self-hosted runner)
  â”œâ”€ Build (Hugo / Maven)
  â”œâ”€ Docker Build & Push (GHCR)
  â”œâ”€ Build Verification âœ…
  â””â”€ GitOps Manifest Update
      â†“
~/k8s-manifests/ (Git repo)
  â”œâ”€ web-rollout.yaml (ì—…ë°ì´íŠ¸)
  â””â”€ was-deployment.yaml (ì—…ë°ì´íŠ¸)
      â†“
ArgoCD (3ì´ˆ Poll)
  â”œâ”€ Git diff ê°ì§€
  â”œâ”€ kubectl apply
  â””â”€ Auto-Sync âœ…
      â†“
Kubernetes Cluster
  â”œâ”€ WEB: Canary ë°°í¬ (Argo Rollouts)
  â””â”€ WAS: Rolling Update
      â†“
Email Notification âœ…
  â””â”€ fw4568@gmail.com
```

**íŠ¹ì§•:**
- âœ… Git = Single Source of Truth
- âœ… ìë™í™”ëœ Canary ë°°í¬ (WEB)
- âœ… Build Verification
- âœ… Email ì•Œë¦¼ (ì„±ê³µ/ì‹¤íŒ¨)
- âœ… ë°°í¬ ì´ë ¥ Gitì— ê¸°ë¡

---

## WAS ê°œì„  ê°€ëŠ¥ í•­ëª©

### âœ… ì™„ë£Œëœ ê°œì„  (P0)

#### 1. Argo Rolloutsë¡œ ì „í™˜ (Canary ë°°í¬) âœ…

**ì™„ë£Œì¼:** 2026-01-22

**ì ìš© ë‚´ìš©:**
```yaml
# was-rollout.yaml
strategy:
  canary:
    dynamicStableScale: true  # Pod ìˆ˜ ìœ ì§€
    steps:
    - setWeight: 20
    - pause: {duration: 1m}
    - setWeight: 50
    - pause: {duration: 1m}
    - setWeight: 80
    - pause: {duration: 1m}
    trafficRouting:
      istio:
        virtualService:
          name: was-retry-timeout
```

**íš¨ê³¼:**
- âœ… ì ì§„ì  ë°°í¬ë¡œ ìœ„í—˜ ìµœì†Œí™”
- âœ… API ì¥ì•  ì‹œ ì¦‰ì‹œ ë¡¤ë°±
- âœ… WEBê³¼ ë™ì¼í•œ ë°°í¬ ì „ëµ
- âœ… dynamicStableScale + DoNotScheduleë¡œ HA ë³´ì¥

---

### P1 (ì„ íƒì  ê°œì„ )

#### 2. ë©”íŠ¸ë¦­ ê¸°ë°˜ Auto-Rollback

**Prometheus ë©”íŠ¸ë¦­ í™œìš©:**
```yaml
# AnalysisTemplate
spec:
  metrics:
  - name: http-error-rate
    successCondition: result < 0.05  # ì—ëŸ¬ìœ¨ 5% ë¯¸ë§Œ
    provider:
      prometheus:
        query: |
          sum(rate(http_requests_total{status=~"5..",app="was"}[5m]))
          /
          sum(rate(http_requests_total{app="was"}[5m]))
```

**íš¨ê³¼:**
- ìë™ ë¡¤ë°± (ì—ëŸ¬ìœ¨ 5% ì´ˆê³¼ ì‹œ)
- ìˆ˜ë™ ê°œì… ë¶ˆí•„ìš”
- ì•ˆì •ì„± í–¥ìƒ

---

### P1 (ì„ íƒì  ê°œì„ )

#### 3. WAS ì†ŒìŠ¤ ì½”ë“œ Git ê´€ë¦¬

**í˜„ì¬:**
- WAS ì½”ë“œ: ë¡œì»¬ì—ë§Œ ì¡´ì¬ (.gitignore)
- GitHub Actions: ë¡œì»¬ ë³µì‚¬ ì‚¬ìš©

**ê°œì„ :**
- Private Git repo ìƒì„± (wlals2/board-was)
- CI/CDì—ì„œ git clone ì‚¬ìš©

**íš¨ê³¼:**
- ë²„ì „ ê´€ë¦¬ ê°€ëŠ¥
- íŒ€ í˜‘ì—… ê°€ëŠ¥
- ì½”ë“œ ì´ë ¥ ì¶”ì 

---

#### 4. Database Migration (Flyway/Liquibase)

**í˜„ì¬:**
- ìˆ˜ë™ Schema ê´€ë¦¬

**ê°œì„ :**
```yaml
# Spring Boot + Flyway
spring:
  flyway:
    enabled: true
    locations: classpath:db/migration

# Migration íŒŒì¼
V1__init_schema.sql
V2__add_comment_table.sql
```

**íš¨ê³¼:**
- Schema ë²„ì „ ê´€ë¦¬
- ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜
- ë¡¤ë°± ê°€ëŠ¥

---

#### 5. MySQL ê³ ê°€ìš©ì„±

**í˜„ì¬:**
- ë‹¨ì¼ Pod (SPOF)
- ë°±ì—… ì—†ìŒ

**ê°œì„ :**
- MySQL Replication (Master-Slave)
- ë˜ëŠ” Managed MySQL (Cloud)
- ìë™ ë°±ì—… ì„¤ì •

---

### P2 (ì¥ê¸° ê³„íš)

#### 6. API Gateway (Kong/Nginx)

**ëª©ì :**
- Rate Limiting
- API Key ê´€ë¦¬
- Request Transformation

---

#### 7. Caching Layer (Redis)

**ëª©ì :**
- DB ë¶€í•˜ ê°ì†Œ
- ì‘ë‹µ ì†ë„ í–¥ìƒ

---

---

## ì „ì²´ ì„œë¹„ìŠ¤ ëª©ë¡

### blog-system Namespace (í•µì‹¬ ì„œë¹„ìŠ¤)

| ì„œë¹„ìŠ¤ | íƒ€ì… | ì—­í•  | ì €ì¥ì†Œ | Replicas |
|--------|------|------|--------|----------|
| **web** | Argo Rollout | Hugo ì •ì  ë¸”ë¡œê·¸ (Private GHCR) | ì—†ìŒ | 2-5 (HPA) |
| **was** | Argo Rollout | Spring Boot API | ì—†ìŒ | 2-10 (HPA) |
| **mysql** | Deployment | ë°ì´í„°ë² ì´ìŠ¤ (Istio ì œì™¸) | Longhorn 5Gi | 1 |
| **mysql-exporter** | Deployment | MySQL ë©”íŠ¸ë¦­ ìˆ˜ì§‘ | ì—†ìŒ | 1 |

### monitoring Namespace (ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ)

| ì„œë¹„ìŠ¤ | íƒ€ì… | ì—­í•  | ì €ì¥ì†Œ | Replicas |
|--------|------|------|--------|----------|
| **prometheus** | Deployment | ë©”íŠ¸ë¦­ ìˆ˜ì§‘/ì €ì¥ | NFS 50Gi | 1 |
| **grafana** | Deployment | ì‹œê°í™” ëŒ€ì‹œë³´ë“œ | NFS 10Gi | 1 |
| **loki-stack** | StatefulSet | ë¡œê·¸ ìˆ˜ì§‘/ì €ì¥ | Longhorn 10Gi | 1 |
| **promtail** | DaemonSet | ë¡œê·¸ ìˆ˜ì§‘ (ê° ë…¸ë“œ) | ì—†ìŒ | 3 (ë…¸ë“œë‹¹ 1) |
| **alertmanager** | Deployment | ì•Œë¦¼ ê´€ë¦¬ | ì—†ìŒ | 1 |
| **pushgateway** | Deployment | ë°°ì¹˜ ì‘ì—… ë©”íŠ¸ë¦­ | NFS 5Gi | 1 |
| **kube-state-metrics** | Deployment | K8s ë¦¬ì†ŒìŠ¤ ë©”íŠ¸ë¦­ | ì—†ìŒ | 1 |
| **prometheus-adapter** | Deployment | Custom Metrics API | ì—†ìŒ | 1 |
| **cadvisor** | DaemonSet | ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ | ì—†ìŒ | 2 (Workerë‹¹ 1) |
| **node-exporter** | DaemonSet | ë…¸ë“œ ë©”íŠ¸ë¦­ | ì—†ìŒ | 3 (ë…¸ë“œë‹¹ 1) |
| **nginx-exporter** | DaemonSet | Nginx ë©”íŠ¸ë¦­ | ì—†ìŒ | 2 |

### istio-system Namespace (Service Mesh)

| ì„œë¹„ìŠ¤ | íƒ€ì… | ì—­í•  |
|--------|------|------|
| **istiod** | Deployment | Control Plane |
| **istio-ingressgateway** | Deployment | ì™¸ë¶€ íŠ¸ë˜í”½ ì¸ì… |
| **istio-egressgateway** | Deployment | ì™¸ë¶€ íŠ¸ë˜í”½ ì†¡ì¶œ |
| **kiali** | Deployment | Service Mesh ì‹œê°í™” |
| **jaeger** | Deployment | ë¶„ì‚° ì¶”ì  |
| **prometheus** | Deployment | Istio ë©”íŠ¸ë¦­ ìˆ˜ì§‘ |

### argocd Namespace (GitOps)

| ì„œë¹„ìŠ¤ | ì—­í•  |
|--------|------|
| **argocd-server** | API Server / Web UI |
| **argocd-repo-server** | Git Repository ê´€ë¦¬ |
| **argocd-application-controller** | Application ë™ê¸°í™” |
| **argocd-dex-server** | SSO/OIDC ì¸ì¦ |
| **argocd-redis** | ìºì‹œ |
| **argocd-notifications-controller** | ì•Œë¦¼ |

### longhorn-system Namespace (ìŠ¤í† ë¦¬ì§€)

| ì„œë¹„ìŠ¤ | íƒ€ì… | ì—­í•  |
|--------|------|------|
| **longhorn-manager** | DaemonSet | ë³¼ë¥¨ ê´€ë¦¬ |
| **longhorn-driver-deployer** | Deployment | CSI ë“œë¼ì´ë²„ ë°°í¬ |
| **longhorn-ui** | Deployment | Web UI |
| **longhorn-csi-plugin** | DaemonSet | CSI í”ŒëŸ¬ê·¸ì¸ |
| **csi-attacher/provisioner/resizer/snapshotter** | Deployment | CSI ì»´í¬ë„ŒíŠ¸ |
| **instance-manager** | Pod | ë³¼ë¥¨ ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬ |
| **engine-image** | DaemonSet | ìŠ¤í† ë¦¬ì§€ ì—”ì§„ |

### ê¸°íƒ€ Namespace

| Namespace | ì„œë¹„ìŠ¤ | ì—­í•  |
|-----------|--------|------|
| **argo-rollouts** | argo-rollouts | Canary/Blue-Green ë°°í¬ |
| **cert-manager** | cert-manager | TLS ì¸ì¦ì„œ ê´€ë¦¬ (ë¯¸ì‚¬ìš©, Cloudflare Tunnel ì‚¬ìš©) |
| **falco** | falco, falcosidekick, talon | ëŸ°íƒ€ì„ ë³´ì•ˆ (IDS + IPS Dry-Run) |
| **metallb-system** | controller, speaker | LoadBalancer IP í• ë‹¹ |
| **kubernetes-dashboard** | dashboard | K8s Web UI |
| **local-path-storage** | local-path-provisioner | ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ |

---

## Helm Chart ê´€ë¦¬

### í˜„ì¬ Helmìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤

| Chart | Version | Namespace | Values ìœ„ì¹˜ |
|-------|---------|-----------|-------------|
| **argo-cd** | 9.3.4 | argocd | [argocd/values.yaml](../k8s-manifests/docs/helm/argocd/values.yaml) |
| **falco** | 0.42.1 | falco | [falco/values.yaml](../k8s-manifests/docs/helm/falco/values.yaml) |
| **longhorn** | 1.7.2 | longhorn-system | [longhorn/values.yaml](../k8s-manifests/docs/helm/longhorn/values.yaml) |
| **loki-stack** | 2.10.2 | monitoring | [loki-stack/values.yaml](../k8s-manifests/docs/helm/loki-stack/values.yaml) |
| **kube-state-metrics** | 5.27.0 | monitoring | [kube-state-metrics/values.yaml](../k8s-manifests/docs/helm/kube-state-metrics/values.yaml) |

### Helm Values ìš”ì•½

**Longhorn:**
```yaml
defaultSettings:
  defaultReplicaCount: 3  # worker 3ê°œë¡œ ë³€ê²½ (2026-01-22)
  nodeDownPodDeletionPolicy: delete-both-statefulset-and-deployment-pod  # ìë™ Failover
```

**Loki-Stack:**
```yaml
loki:
  persistence:
    enabled: true
    size: 10Gi
  config:
    table_manager:
      retention_deletes_enabled: true  # ìë™ ì‚­ì œ í™œì„±í™”
      retention_period: 168h           # 7ì¼ ë³´ê´€ (2026-01-23 ë³€ê²½)
promtail:
  enabled: true
```

**ArgoCD:**
```yaml
# ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì¹˜ (ì˜¤ë²„ë¼ì´ë“œ ì—†ìŒ)
```

**Falco (ëŸ°íƒ€ì„ ë³´ì•ˆ IDS/IPS):**
```yaml
driver:
  kind: modern_ebpf  # Cilium ì¶©ëŒ ë°©ì§€
falcosidekick:
  enabled: true
  config:
    loki:
      hostport: "http://loki-stack.monitoring.svc.cluster.local:3100"

# Falco Talon (IPS, 2026-01-23 ì¶”ê°€)
config:
  dry_run: true  # Phase 1: Dry-Run ëª¨ë“œ (1ì£¼ê°„ í•™ìŠµ)
  rules:
    - name: isolate-rce
      match:
        priority: CRITICAL
      actions:
        - action: kubernetes:networkpolicy  # Pod ê²©ë¦¬
```

---

## ê´€ë ¨ ë¬¸ì„œ

| ë¬¸ì„œ | ì„¤ëª… |
|------|------|
| [CICD-PIPELINE.md](CICD/CICD-PIPELINE.md) | CI/CD íŒŒì´í”„ë¼ì¸ ìƒì„¸ |
| [GITOPS-IMPLEMENTATION.md](CICD/GITOPS-IMPLEMENTATION.md) | GitOps êµ¬í˜„ ê°€ì´ë“œ |
| [02-INFRASTRUCTURE.md](02-INFRASTRUCTURE.md) | ì¸í”„ë¼ êµ¬ì„± |
| [monitoring/README.md](monitoring/README.md) | ëª¨ë‹ˆí„°ë§ ì„¤ì • |
| [istio/COMPLETE-ISTIO-ARCHITECTURE.md](istio/COMPLETE-ISTIO-ARCHITECTURE.md) | Istio ì•„í‚¤í…ì²˜ |
| [security/security-falco.md](security/security-falco.md) | Falco ëŸ°íƒ€ì„ ë³´ì•ˆ |

---

**ì‘ì„±:** Claude Code
**ìµœì¢… ìˆ˜ì •:** 2026-01-24 (4-node í´ëŸ¬ìŠ¤í„° ë°˜ì˜, DevSecOps P0 ì™„ë£Œ)
**ìƒíƒœ:** âœ… Production ìš´ì˜ ì¤‘ (58ì¼+, worker3 ì¶”ê°€, Falco Talon IPS Dry-Run)
