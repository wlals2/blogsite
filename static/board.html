<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œíŒ - Jimin's Blog</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 40px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post-card {
            transition: transform 0.2s;
        }
        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .btn-group-actions {
            gap: 5px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .alert {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <div class="card-body">
                <h1 class="card-title">ğŸ“ ê²Œì‹œíŒ</h1>
                <p class="card-text text-muted">Kubernetes + Spring Boot + MySQL</p>
                <a href="/" class="btn btn-outline-secondary btn-sm">â† ë¸”ë¡œê·¸ í™ˆìœ¼ë¡œ</a>
            </div>
        </div>

        <!-- Alert Message -->
        <div id="alertMessage" class="alert d-none" role="alert"></div>

        <!-- Loading Spinner -->
        <div id="loading" class="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <!-- New Post Form -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">âœï¸ ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h5>
            </div>
            <div class="card-body">
                <form id="postForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">ì œëª©</label>
                        <input type="text" class="form-control" id="title" required placeholder="ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="mb-3">
                        <label for="content" class="form-label">ë‚´ìš©</label>
                        <textarea class="form-control" id="content" rows="5" required placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="author" class="form-label">ì‘ì„±ì</label>
                        <input type="text" class="form-control" id="author" required placeholder="ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button type="submit" class="btn btn-primary">ê²Œì‹œê¸€ ì‘ì„±</button>
                    <button type="button" class="btn btn-secondary" id="cancelEdit">ì·¨ì†Œ</button>
                </form>
            </div>
        </div>

        <!-- Posts List -->
        <div class="card">
            <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡</h5>
                <button class="btn btn-light btn-sm" onclick="loadPosts()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div class="card-body">
                <div id="postsList" class="row">
                    <!-- Posts will be loaded here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // API Base URL
        const API_BASE_URL = '/api/posts';

        // Current editing post ID
        let editingPostId = null;

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.classList.remove('d-none');

            // Auto hide after 3 seconds
            setTimeout(() => {
                alertDiv.classList.add('d-none');
            }, 3000);
        }

        // Show/hide loading spinner
        function setLoading(isLoading) {
            document.getElementById('loading').style.display = isLoading ? 'block' : 'none';
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Load all posts
        async function loadPosts() {
            setLoading(true);
            try {
                const response = await fetch(API_BASE_URL);
                if (!response.ok) throw new Error('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

                const posts = await response.json();
                displayPosts(posts);
                showAlert(`ì´ ${posts.length}ê°œì˜ ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'info');
            } catch (error) {
                console.error('Error loading posts:', error);
                showAlert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            } finally {
                setLoading(false);
            }
        }

        // Display posts
        function displayPosts(posts) {
            const postsContainer = document.getElementById('postsList');

            if (posts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info">
                            ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!
                        </div>
                    </div>
                `;
                return;
            }

            postsContainer.innerHTML = posts.map(post => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card post-card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${escapeHtml(post.title)}</h5>
                            <p class="card-text">${escapeHtml(post.content)}</p>
                            <p class="card-text">
                                <small class="text-muted">
                                    ğŸ‘¤ ${escapeHtml(post.author)}<br>
                                    ğŸ•’ ${formatDate(post.createdAt)}
                                </small>
                            </p>
                        </div>
                        <div class="card-footer bg-transparent">
                            <div class="d-flex btn-group-actions">
                                <button class="btn btn-sm btn-outline-primary flex-fill" onclick="editPost(${post.id})">
                                    âœï¸ ìˆ˜ì •
                                </button>
                                <button class="btn btn-sm btn-outline-danger flex-fill" onclick="deletePost(${post.id})">
                                    ğŸ—‘ï¸ ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Create or update post
        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const author = document.getElementById('author').value;

            const postData = { title, content, author };

            setLoading(true);
            try {
                let response;
                if (editingPostId) {
                    // Update existing post
                    response = await fetch(`${API_BASE_URL}/${editingPostId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(postData)
                    });
                    showAlert('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    // Create new post
                    response = await fetch(API_BASE_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(postData)
                    });
                    showAlert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }

                if (!response.ok) throw new Error('ê²Œì‹œê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

                // Reset form and reload posts
                resetForm();
                loadPosts();
            } catch (error) {
                console.error('Error saving post:', error);
                showAlert('ê²Œì‹œê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            } finally {
                setLoading(false);
            }
        });

        // Edit post
        async function editPost(id) {
            setLoading(true);
            try {
                const response = await fetch(`${API_BASE_URL}/${id}`);
                if (!response.ok) throw new Error('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

                const post = await response.json();

                // Fill form with post data
                document.getElementById('title').value = post.title;
                document.getElementById('content').value = post.content;
                document.getElementById('author').value = post.author;

                editingPostId = id;

                // Scroll to form
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showAlert('ê²Œì‹œê¸€ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
            } catch (error) {
                console.error('Error loading post:', error);
                showAlert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            } finally {
                setLoading(false);
            }
        }

        // Delete post
        async function deletePost(id) {
            if (!confirm('ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            setLoading(true);
            try {
                const response = await fetch(`${API_BASE_URL}/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');

                showAlert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
                loadPosts();
            } catch (error) {
                console.error('Error deleting post:', error);
                showAlert('ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            } finally {
                setLoading(false);
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('postForm').reset();
            editingPostId = null;
        }

        // Cancel edit button
        document.getElementById('cancelEdit').addEventListener('click', resetForm);

        // Load posts on page load
        window.addEventListener('DOMContentLoaded', loadPosts);
    </script>
</body>
</html>
