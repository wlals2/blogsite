---
title: "Elasticsearch 기초: 색인과 역색인 이해하기"
date: 2025-10-11
categories: ["Elasticsearch", "Search Engine"]
tags: ["Elasticsearch", "Inverted Index", "검색엔진", "색인"]
draft: false
author: "늦찌민"
description: "기초적인 것부터 잡자 색인,역색인 feat Elasitcsearch"
series: "ES구축기"
---
###  🔍 들어가며
엘라스틱서치를 공부하다 보면 **색인(index)** 과 **역색인(inverted index)** 이라는 단어가 자주 등장합니다.  
처음 들으면 어렵게 느껴지지만, 사실은 **“책의 찾아보기”** 와 같은 개념입니다.  
이번 글에서는 “색인과 역색인의 차이”를 단계별로 쉽게 정리해보겠습니다.

---

###  📘 1️⃣ 색인이란?

색인은 데이터를 “검색하기 쉽게 정리해 저장하는 과정”을 말합니다.  
책의 맨 뒤 “찾아보기(Index)”를 떠올려 보세요.

> 예를 들어 “귀엽다”라는 단어가 몇 페이지에 나오는지 적어두면,  
> 전체 책을 읽지 않고도 바로 찾아갈 수 있죠.

데이터베이스(DB)에서도 색인은 이런 역할을 합니다.  
엘라스틱서치에서는 문서 데이터를 색인 구조로 변환하여 검색 속도를 극대화합니다.

---

### 🧩 2️⃣ 역색인이란?

DB의 일반적인 구조는 이렇게 되어 있습니다:

> 문서1 → "고양이가 귀엽다" \
> 문서2 → "강아지가 귀엽다" \


**이건 “정방향 색인(Forward Index)” 형태입니다.**

하지만 검색엔진은 반대로 동작합니다.
“귀엽다”가 들어간 문서를 찾고 싶다면?
엘라스틱서치는 이렇게 저장 👇

> "고양이" → [문서1] \
> "강아지" → [문서2] \
> "귀엽다" → [문서1, 문서2]


이처럼 **단어(토큰)** 를 기준으로 “어떤 문서에 등장했는가”를 연결해 둔 구조를  
**역색인(Inverted Index)** 이라고 합니다.  
즉, **검색 속도를 위해 단어 중심으로 미리 색인을 만들어 두는 방식**입니다.

---

###  ⚙️ 3️⃣ 색인 과정 단계별 정리

엘라스틱서치가 문서를 색인할 때 내부적으로는 다음 과정을 거칩니다:

| 단계 | 이름 | 설명 |
|------|------|------|
| ① | **분석(Analyze)** | 문장을 단어로 쪼갬 (Tokenizer + Filter) |
| ② | **토큰 저장** | 각 단어를 색인에 등록 |
| ③ | **역색인 구조 생성** | 단어 → 문서 ID로 연결 |
| ④ | **검색(Search)** | 검색어의 단어 목록을 빠르게 찾아 반환 |

이 덕분에, 사용자가 `"귀엽다"` 라고 검색하면  
ES는 미리 만들어 둔 인덱스를 통해 즉시 관련 문서를 찾을 수 있습니다.

---

###  🧱 4️⃣ nested는 또 뭐지?

엘라스틱서치에서 `nested` 타입은 **배열 속 객체**를 다룰 때 사용하는 색인 방식입니다.

예를 들어:

```json
"spec": [
  { "cores": 12, "memory": 128 },
  { "cores": 6, "memory": 64 }
]
```

이런 구조에서 "cores":6 AND "memory":128 을 검색하면
서로 다른 객체의 값이 섞여 잘못 매칭될 수 있습니다.
그래서 nested 타입을 사용하면
엘라스틱서치가 각 객체를 별도의 작은 문서처럼 색인합니다.

즉,
- 일반 object → 단순 병합 (빠르지만 정확도 낮음)
- nested object → 내부 문서로 나눔 (정확도 높음)

---

### 🌳 5️⃣ 숫자 데이터는 어떻게 색인될까? (BKD 트리)

> 단어(문자열)는 역색인으로 처리하지만,
숫자나 날짜는 단어처럼 나눌 수 없기 때문에
엘라스틱서치는 BKD 트리라는 자료구조를 사용합니다.

간단히 말하면,

“숫자 값을 빠르게 정렬하고 범위를 찾기 위한 트리 구조”

예를 들어, \
**memory: 32, memory: 64, memory: 128**
이런 숫자들을 저장할 때 BKD 트리가 정렬된 구조로 색인해
“64 이상” 같은 범위 검색을 빠르게 수행합니다.

---

### 💬 6️⃣ 핵심 요약

| 개념                      | 역할               | 예시                          |
| ----------------------- | ---------------- | --------------------------- |
| **색인(Index)**           | 검색하기 쉽게 데이터를 구조화 | 책의 ‘찾아보기’                   |
| **역색인(Inverted Index)** | 단어 → 문서ID로 매핑    | `"귀엽다" → [문서1, 문서2]`        |
| **nested**              | 배열 내부의 객체를 따로 색인 | `"spec"` 안의 각 객체를 별도 문서로 저장 |
| **BKD 트리**              | 숫자/날짜를 위한 색인 구조  | 빠른 범위 검색 지원                 |

---

### 💬 예시 요약

```json
# ① 문자열 검색 (역색인)
GET /object_test/_search
{
  "query": {
    "term": { "name.keyword": "server01" }
  }
}

# ② 숫자 검색 (BKD 트리 기반)
GET /object_test/_search
{
  "query": {
    "range": { "spec.memory": { "gte": 64, "lte": 256 } }
  }
}

# ③ 배열 내부 매칭 (nested)
GET /object_test/_search
{
  "query": {
    "nested": {
      "path": "spec",
      "query": {
        "bool": {
          "must": [
            { "term": { "spec.cores": 6 } },
            { "term": { "spec.memory": 128 } }
          ]
        }
      }
    }
  }
}
```

---
### ✏️ 마무리

- 역색인은 “단어 중심의 색인 구조”
- nested는 “객체 단위의 색인 구조”
- BKD 트리는 “숫자 중심의 색인 구조”
